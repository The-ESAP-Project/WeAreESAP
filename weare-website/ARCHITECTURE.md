# æ¶æ„è®¾è®¡æ–‡æ¡£

æœ¬æ–‡æ¡£æè¿°äº† WeAreESAP é¡¹ç›®çš„æ•´ä½“æ¶æ„ã€è®¾è®¡å†³ç­–å’ŒæŠ€æœ¯å®ç°ç»†èŠ‚ã€‚

## ç›®å½•

- [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
- [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
- [å…³é”®è®¾è®¡å†³ç­–](#å…³é”®è®¾è®¡å†³ç­–)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æ‰©å±•æŒ‡å—](#æ‰©å±•æŒ‡å—)

---

## é¡¹ç›®æ¦‚è§ˆ

WeAreESAP æ˜¯ä¸€ä¸ªç§‘å¹»ä¸–ç•Œè§‚åˆ›ä½œä¼åˆ’çš„å®˜æ–¹ç½‘ç«™ï¼Œè®²è¿°ä»¿ç”Ÿäººä¸äººç±»å…±å­˜çš„æœªæ¥æ•…äº‹ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„ Web æŠ€æœ¯æ ˆï¼Œæ³¨é‡æ€§èƒ½ã€ç”¨æˆ·ä½“éªŒå’Œå¯ç»´æŠ¤æ€§ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**

- ğŸ“± å“åº”å¼è®¾è®¡ï¼ˆæ¡Œé¢ç«¯ + ç§»åŠ¨ç«¯ï¼‰
- ğŸŒ å›½é™…åŒ–æ”¯æŒï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ï¼‰
- ğŸ¨ æ·±æµ…è‰²ä¸»é¢˜åˆ‡æ¢
- âš¡ æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨ã€å›¾ç‰‡ä¼˜åŒ–ã€ç¼“å­˜ï¼‰
- â™¿ æ— éšœç¢æ”¯æŒï¼ˆå‡å°‘åŠ¨ç”»ã€è¯­ä¹‰åŒ– HTMLï¼‰

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶

| æŠ€æœ¯             | ç‰ˆæœ¬   | ç”¨é€”                        |
| ---------------- | ------ | --------------------------- |
| **Next.js**      | 16.0.1 | React æ¡†æ¶ï¼Œä½¿ç”¨ App Router |
| **React**        | 19.2.0 | UI åº“                       |
| **TypeScript**   | 5.x    | ç±»å‹å®‰å…¨                    |
| **Tailwind CSS** | 4.x    | åŸå­åŒ– CSS æ¡†æ¶             |

### åŠŸèƒ½åº“

| æŠ€æœ¯                        | ç”¨é€”           |
| --------------------------- | -------------- |
| **next-intl**               | å›½é™…åŒ–ï¼ˆi18nï¼‰ |
| **framer-motion**           | åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ |
| **next-themes**             | ä¸»é¢˜åˆ‡æ¢       |
| **reactflow**               | å…³ç³»å›¾è°±å¯è§†åŒ– |
| **elkjs**                   | å›¾å¸ƒå±€ç®—æ³•     |
| **@tanstack/react-virtual** | è™šæ‹Ÿæ»šåŠ¨       |
| **pangu**                   | ä¸­è‹±æ–‡æ’ç‰ˆä¼˜åŒ– |

### æµ‹è¯•å·¥å…·

| æŠ€æœ¯                      | ç”¨é€”     |
| ------------------------- | -------- |
| **Vitest**                | å•å…ƒæµ‹è¯• |
| **Playwright**            | E2E æµ‹è¯• |
| **React Testing Library** | ç»„ä»¶æµ‹è¯• |

---

## ç›®å½•ç»“æ„

```
website/
â”œâ”€â”€ app/                        # Next.js App Router
â”‚   â””â”€â”€ [locale]/              # å›½é™…åŒ–è·¯ç”±
â”‚       â”œâ”€â”€ page.tsx           # é¦–é¡µ
â”‚       â”œâ”€â”€ characters/        # è§’è‰²ç›¸å…³é¡µé¢
â”‚       â”œâ”€â”€ tech/              # æŠ€æœ¯è®¾å®šé¡µé¢
â”‚       â”œâ”€â”€ timeline/          # æ—¶é—´çº¿é¡µé¢
â”‚       â”œâ”€â”€ project/           # é¡¹ç›®ä»‹ç»
â”‚       â””â”€â”€ join/              # åŠ å…¥æˆ‘ä»¬
â”‚
â”œâ”€â”€ components/                # React ç»„ä»¶
â”‚   â”œâ”€â”€ character/            # è§’è‰²ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CharacterAccordion.tsx    # æ‰‹é£ç´å±•ç¤º
â”‚   â”‚   â”œâ”€â”€ CharacterCard.tsx         # è§’è‰²å¡ç‰‡
â”‚   â”‚   â””â”€â”€ detail/                   # è¯¦æƒ…é¡µç»„ä»¶
â”‚   â”œâ”€â”€ layout/               # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Navigation.tsx    # å¯¼èˆªæ 
â”‚   â”‚   â””â”€â”€ Footer.tsx        # é¡µè„š
â”‚   â”œâ”€â”€ timeline/             # æ—¶é—´çº¿ç»„ä»¶
â”‚   â”œâ”€â”€ tech/                 # æŠ€æœ¯è®¾å®šç»„ä»¶
â”‚   â”œâ”€â”€ ui/                   # é€šç”¨ UI ç»„ä»¶
â”‚   â””â”€â”€ analytics/            # æ€§èƒ½ç›‘æ§
â”‚
â”œâ”€â”€ data/                      # JSON æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ characters/           # è§’è‰²æ•°æ®
â”‚   â”‚   â”œâ”€â”€ zh-CN/           # ä¸­æ–‡æ•°æ®
â”‚   â”‚   â”œâ”€â”€ en/              # è‹±æ–‡æ•°æ®
â”‚   â”‚   â”œâ”€â”€ ja/              # æ—¥æ–‡æ•°æ®
â”‚   â”‚   â””â”€â”€ relations/       # è§’è‰²å…³ç³»
â”‚   â”œâ”€â”€ timeline/            # æ—¶é—´çº¿æ•°æ®
â”‚   â”œâ”€â”€ tech/                # æŠ€æœ¯è®¾å®š
â”‚   â””â”€â”€ project/             # é¡¹ç›®ä»‹ç»
â”‚
â”œâ”€â”€ lib/                      # å·¥å…·å‡½æ•°åº“
â”‚   â”œâ”€â”€ data-loader.ts       # æ•°æ®åŠ è½½å·¥å…·
â”‚   â”œâ”€â”€ relationship-parser.ts  # å…³ç³»è§£æ
â”‚   â”œâ”€â”€ graph-layout.ts      # å›¾å¸ƒå±€ç®—æ³•
â”‚   â””â”€â”€ utils.ts             # é€šç”¨å·¥å…·
â”‚
â”œâ”€â”€ types/                    # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ messages/                 # å›½é™…åŒ–ç¿»è¯‘æ–‡ä»¶
â”œâ”€â”€ i18n/                     # å›½é™…åŒ–é…ç½®
â”œâ”€â”€ hooks/                    # è‡ªå®šä¹‰ React Hooks
â”œâ”€â”€ e2e/                      # E2E æµ‹è¯•
â””â”€â”€ scripts/                  # æ„å»ºè„šæœ¬
```

---

## æ ¸å¿ƒæ¶æ„

### 1. Next.js App Router æ¶æ„

é¡¹ç›®ä½¿ç”¨ Next.js 16 çš„ App Routerï¼Œé‡‡ç”¨ **æ–‡ä»¶ç³»ç»Ÿè·¯ç”±**ï¼š

```
app/[locale]/
â”œâ”€â”€ page.tsx                  â†’ /
â”œâ”€â”€ characters/page.tsx       â†’ /characters
â”œâ”€â”€ characters/[id]/page.tsx  â†’ /characters/1547
â””â”€â”€ timeline/page.tsx         â†’ /timeline
```

**å…³é”®ç‰¹æ€§ï¼š**

- âœ… React Server Components (RSC)
- âœ… è‡ªåŠ¨ä»£ç åˆ†å‰²
- âœ… æµå¼æ¸²æŸ“ï¼ˆStreamingï¼‰
- âœ… å¸ƒå±€åµŒå¥—ï¼ˆNested Layoutsï¼‰

### 2. æ•°æ®é©±åŠ¨æ¶æ„

**è®¾è®¡ç†å¿µï¼š** æ‰€æœ‰å†…å®¹ï¼ˆè§’è‰²ã€æ—¶é—´çº¿ã€æŠ€æœ¯è®¾å®šï¼‰å­˜å‚¨ä¸º JSON æ–‡ä»¶ï¼Œé€šè¿‡ç»Ÿä¸€çš„æ•°æ®åŠ è½½å™¨è¯»å–ã€‚

```typescript
// æ•°æ®åŠ è½½ç¤ºä¾‹
const characters = await loadJsonFiles<CharacterCardData>(
  ["data", "characters"],
  locale
);
```

**ä¼˜åŠ¿ï¼š**

- âœ… æ˜“äºç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰
- âœ… æ”¯æŒç¤¾åŒºè´¡çŒ®
- âœ… æ— éœ€æ•°æ®åº“
- âœ… æ„å»ºæ—¶ç”Ÿæˆé™æ€é¡µé¢
- âœ… å¤šè¯­è¨€å›é€€æœºåˆ¶

### 3. å›½é™…åŒ–æ–¹æ¡ˆ

ä½¿ç”¨ `next-intl` å®ç°å›½é™…åŒ–ï¼Œé…ç½®å¦‚ä¸‹ï¼š

```typescript
// i18n/routing.ts
export const routing = defineRouting({
  locales: ["zh-CN", "en", "ja"],
  defaultLocale: "zh-CN",
  localePrefix: "as-needed", // é»˜è®¤ locale ä¸æ˜¾ç¤ºåœ¨ URL
});
```

**URL ç»“æ„ï¼š**

- `/` â†’ ä¸­æ–‡ç‰ˆï¼ˆé»˜è®¤ï¼‰
- `/en` â†’ è‹±æ–‡ç‰ˆ
- `/ja` â†’ æ—¥æ–‡ç‰ˆ

**å›é€€æœºåˆ¶ï¼š**
å½“æŸä¸ª locale çš„å†…å®¹ä¸å­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨å›é€€åˆ° `zh-CN`ã€‚

---

## å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆç”¨ JSON è€Œä¸æ˜¯ CMSï¼Ÿ

**ç†ç”±ï¼š**

- âœ… **ç‰ˆæœ¬æ§åˆ¶å‹å¥½**ï¼šGit å¯ä»¥è¿½è¸ªæ‰€æœ‰å†…å®¹å˜æ›´
- âœ… **å¼€æºç¤¾åŒºå‹å¥½**ï¼šè´¡çŒ®è€…å¯ä»¥ç›´æ¥æäº¤ PR æ·»åŠ å†…å®¹
- âœ… **é›¶è¿ç»´æˆæœ¬**ï¼šæ— éœ€ç»´æŠ¤æ•°æ®åº“
- âœ… **é™æ€ç”Ÿæˆ**ï¼šæ„å»ºæ—¶ç”Ÿæˆæ‰€æœ‰é¡µé¢ï¼Œæ€§èƒ½æœ€ä½³
- âœ… **ç±»å‹å®‰å…¨**ï¼šTypeScript ç±»å‹å®šä¹‰ç¡®ä¿æ•°æ®æ ¼å¼æ­£ç¡®

**æƒè¡¡ï¼š**

- âŒ ç¼ºå°‘æ‰€è§å³æ‰€å¾—ç¼–è¾‘å™¨
- âŒ éæŠ€æœ¯ç”¨æˆ·ç¼–è¾‘å†…å®¹éœ€è¦å­¦ä¹  JSON è¯­æ³•

### 2. ä¸ºä»€ä¹ˆç”¨æ‰‹é£ç´äº¤äº’ï¼Ÿ

**æ¡Œé¢ç«¯è§’è‰²åˆ—è¡¨ä½¿ç”¨æ‰‹é£ç´ï¼ˆAccordionï¼‰è€Œä¸æ˜¯ç½‘æ ¼ï¼ˆGridï¼‰ï¼š**

**ç†ç”±ï¼š**

- âœ… **ç‹¬ç‰¹çš„è§†è§‰ä½“éªŒ**ï¼šæ–œåˆ‡å¤šè¾¹å½¢å¸ƒå±€ï¼Œå¥‘åˆç§‘å¹»é£æ ¼
- âœ… **ä¿¡æ¯å¯†åº¦é«˜**ï¼šä¸€å±å±•ç¤ºæ›´å¤šè§’è‰²
- âœ… **äº¤äº’æ›´æµç•…**ï¼šå±•å¼€/æ”¶èµ·åŠ¨ç”»ï¼Œç”¨æˆ·å‚ä¸æ„Ÿå¼º
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šæ™ºèƒ½å»¶è¿Ÿå±•å¼€ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“

**ç§»åŠ¨ç«¯ï¼š** ä½¿ç”¨æŠ˜å åˆ—è¡¨ï¼Œé€‚åº”å°å±å¹•ã€‚

### 3. ä¸ºä»€ä¹ˆé€‰æ‹© ReactFlowï¼Ÿ

**ç”¨äºè§’è‰²å…³ç³»å›¾è°±å¯è§†åŒ–ï¼š**

**ç†ç”±ï¼š**

- âœ… **åŠŸèƒ½å®Œå–„**ï¼šæ‹–æ‹½ã€ç¼©æ”¾ã€å¹³ç§»å¼€ç®±å³ç”¨
- âœ… **è‡ªå®šä¹‰èŠ‚ç‚¹**ï¼šå¯ä»¥è‡ªå®šä¹‰èŠ‚ç‚¹æ ·å¼
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šè™šæ‹ŸåŒ–æ¸²æŸ“ï¼Œæ”¯æŒå¤§è§„æ¨¡å›¾è°±
- âœ… **ç¤¾åŒºæ´»è·ƒ**ï¼šæ–‡æ¡£å®Œå–„ï¼Œç”Ÿæ€æˆç†Ÿ

**é…åˆ ELK ç®—æ³•ï¼š** è‡ªåŠ¨å¸ƒå±€ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒæ•´èŠ‚ç‚¹ä½ç½®ã€‚

---

## æ•°æ®æµ

### 1. æ•°æ®åŠ è½½æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ /characters
    â†“
Next.js Server Component
    â†“
loadJsonFiles(['data', 'characters'], locale)
    â†“
æ£€æŸ¥ locale ç›®å½•æ˜¯å¦å­˜åœ¨
    â†“ å­˜åœ¨              â†“ ä¸å­˜åœ¨
è¯»å– locale æ–‡ä»¶    å›é€€åˆ° zh-CN
    â†“
è¿”å›æ•°æ®
    â†“
æ¸²æŸ“é¡µé¢
```

### 2. ç¼“å­˜ç­–ç•¥

**Next.js unstable_cacheï¼š**

```typescript
const getCharacters = unstable_cache(
  async (locale: string) => {
    return await loadJsonFiles(["data", "characters"], locale);
  },
  ["characters"],
  {
    revalidate: 3600, // 1 å°æ—¶ç¼“å­˜
    tags: ["characters"],
  }
);
```

**HTTP ç¼“å­˜å¤´ï¼š**

- é™æ€èµ„æºï¼š`max-age=31536000, immutable`ï¼ˆ1 å¹´ï¼‰
- HTML é¡µé¢ï¼š`public, max-age=0, must-revalidate`

### 3. å›½é™…åŒ–å›é€€æœºåˆ¶

```
è¯·æ±‚ /en/characters
    â†“
æ£€æŸ¥ data/characters/en/ æ˜¯å¦å­˜åœ¨
    â†“ ä¸å­˜åœ¨
å›é€€åˆ° data/characters/zh-CN/
    â†“
è¿”å›ä¸­æ–‡æ•°æ®
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. å›¾ç‰‡ä¼˜åŒ–

**æŠ€æœ¯ï¼š**

- Next.js Image ç»„ä»¶
- AVIF / WebP æ ¼å¼
- å“åº”å¼å°ºå¯¸
- æ‡’åŠ è½½
- æ¨¡ç³Šå ä½ç¬¦ï¼ˆBlur Placeholderï¼‰

**å®ç°ï¼š**

```typescript
<Image
  src={character.backgroundImage}
  alt={character.name}
  fill
  sizes="(max-width: 640px) 100vw, ..."
  loading="lazy"
  placeholder="blur"
  blurDataURL={getBlurDataURL(character.backgroundImage)}
/>
```

### 2. è™šæ‹Ÿæ»šåŠ¨

**æ—¶é—´çº¿é¡µé¢ä½¿ç”¨ `@tanstack/react-virtual`ï¼š**

```typescript
const virtualizer = useVirtualizer({
  count: events.length,
  getScrollElement: () => parentRef.current,
  estimateSize: () => 200, // ä¼°ç®—æ¯é¡¹é«˜åº¦
});
```

**ä¼˜åŠ¿ï¼š**

- âœ… åªæ¸²æŸ“å¯è§åŒºåŸŸçš„å…ƒç´ 
- âœ… æ”¯æŒå¤§é‡äº‹ä»¶å±•ç¤ºï¼ˆ1000+ æ¡ï¼‰
- âœ… æ»šåŠ¨æ€§èƒ½ä¼˜ç§€

### 3. ä»£ç åˆ†å‰²

**è‡ªåŠ¨åˆ†å‰²ï¼š**

- Next.js è‡ªåŠ¨æŒ‰é¡µé¢åˆ†å‰²ä»£ç 
- åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰æ‡’åŠ è½½ç»„ä»¶

**ç¤ºä¾‹ï¼š**

```typescript
const RelationshipGraph = dynamic(
  () => import("@/components/character/RelationshipGraph"),
  { ssr: false }
);
```

### 4. React æ€§èƒ½ä¼˜åŒ–

**ä½¿ç”¨åœºæ™¯ï¼š**

- `memo` - é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- `useCallback` - ç¼“å­˜å›è°ƒå‡½æ•°
- `useMemo` - ç¼“å­˜è®¡ç®—ç»“æœ

**ç»Ÿè®¡ï¼š** é¡¹ç›®ä¸­å…±ä½¿ç”¨ 47 å¤„æ€§èƒ½ä¼˜åŒ–ã€‚

### 5. æ— éšœç¢æ”¯æŒ

**å‡å°‘åŠ¨ç”»ï¼š**

```typescript
const shouldReduceMotion = useReducedMotion()

// æ ¹æ®ç”¨æˆ·åå¥½ç¦ç”¨åŠ¨ç”»
initial={shouldReduceMotion ? { opacity: 1 } : { opacity: 0, y: 20 }}
```

**CSS é…ç½®ï¼š**

```css
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
  }
}
```

---

## æ‰©å±•æŒ‡å—

### 1. å¦‚ä½•æ·»åŠ æ–°è§’è‰²

**æ­¥éª¤ï¼š**

1. **åˆ›å»ºè§’è‰²æ•°æ®æ–‡ä»¶**

åœ¨ `data/characters/zh-CN/` ç›®å½•ä¸‹åˆ›å»º `{id}.json`ï¼š

```json
{
  "id": "9999",
  "name": "AptS:9999",
  "tier": "core",
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
  "quote": "å¼•è¨€",
  "color": {
    "primary": "#FF6B6B",
    "secondary": "#4ECDC4"
  },
  "backgroundImage": "/images/characters/9999.jpg"
}
```

2. **æ·»åŠ ç¿»è¯‘**

å¤åˆ¶æ–‡ä»¶åˆ° `data/characters/en/` å’Œ `data/characters/ja/`ï¼Œç¿»è¯‘å†…å®¹ã€‚

3. **ï¼ˆå¯é€‰ï¼‰æ·»åŠ å…³ç³»æ•°æ®**

åœ¨ `data/characters/relations/` åˆ›å»º `{id}.json`ï¼š

```json
{
  "characterId": "9999",
  "relationships": [
    {
      "targetId": "1547",
      "type": "friend",
      "label": "æœ‹å‹",
      "description": "æè¿°"
    }
  ]
}
```

4. **æ·»åŠ å¤´åƒ/èƒŒæ™¯å›¾**

å°†å›¾ç‰‡æ”¾åˆ° `public/images/characters/` ç›®å½•ã€‚

5. **é‡æ–°æ„å»º**

```bash
pnpm build
```

### 2. å¦‚ä½•æ·»åŠ æ–°é¡µé¢

**æ­¥éª¤ï¼š**

1. **åˆ›å»ºé¡µé¢æ–‡ä»¶**

åœ¨ `app/[locale]/` ä¸‹åˆ›å»ºæ–°ç›®å½•ï¼š

```typescript
// app/[locale]/new-page/page.tsx
export default function NewPage() {
  return <div>æ–°é¡µé¢</div>
}
```

2. **æ·»åŠ å¯¼èˆªé“¾æ¥**

ç¼–è¾‘ `components/layout/Navigation.tsx`ï¼š

```typescript
const navLinks = [
  // ...
  { href: "/new-page", key: "newPage" },
];
```

3. **æ·»åŠ ç¿»è¯‘**

åœ¨ `messages/zh-CN/common.json` ä¸­æ·»åŠ ï¼š

```json
{
  "navigation": {
    "newPage": "æ–°é¡µé¢"
  }
}
```

4. **ï¼ˆå¯é€‰ï¼‰æ·»åŠ å…ƒæ•°æ®**

```typescript
export const metadata: Metadata = {
  title: "æ–°é¡µé¢ - We Are ESAP",
  description: "é¡µé¢æè¿°",
};
```

### 3. å¦‚ä½•æ·»åŠ æ–°è¯­è¨€

**æ­¥éª¤ï¼š**

1. **æ›´æ–°è·¯ç”±é…ç½®**

ç¼–è¾‘ `i18n/routing.ts`ï¼š

```typescript
export const routing = defineRouting({
  locales: ["zh-CN", "en", "ja", "ko"], // æ·»åŠ éŸ©è¯­
  defaultLocale: "zh-CN",
  localePrefix: "as-needed",
});
```

2. **åˆ›å»ºç¿»è¯‘æ–‡ä»¶**

å¤åˆ¶ `messages/zh-CN/` åˆ° `messages/ko/`ï¼Œç¿»è¯‘æ‰€æœ‰å†…å®¹ã€‚

3. **åˆ›å»ºæ•°æ®æ–‡ä»¶**

å¤åˆ¶ `data/characters/zh-CN/` åˆ° `data/characters/ko/`ï¼Œç¿»è¯‘è§’è‰²æ•°æ®ã€‚

4. **æ›´æ–°è¯­è¨€åˆ‡æ¢å™¨**

ç¼–è¾‘ `components/ui/LanguageSwitcher.tsx`ï¼Œæ·»åŠ æ–°è¯­è¨€é€‰é¡¹ã€‚

### 4. å¦‚ä½•æ·»åŠ æ–°çš„æ—¶é—´çº¿äº‹ä»¶

**æ­¥éª¤ï¼š**

1. **ç¼–è¾‘æ—¶é—´çº¿æ•°æ®**

åœ¨ `data/timeline/zh-CN/` ä¸‹æ‰¾åˆ°å¯¹åº”å¹´ä»½çš„æ–‡ä»¶ï¼ˆå¦‚ `2025.json`ï¼‰ï¼š

```json
{
  "events": [
    {
      "id": "new-event-1",
      "date": "2025-12-01",
      "type": "milestone",
      "importance": "major",
      "title": "äº‹ä»¶æ ‡é¢˜",
      "content": [{ "type": "paragraph", "text": "äº‹ä»¶æè¿°" }]
    }
  ]
}
```

2. **æ·»åŠ ç¿»è¯‘**

å¤åˆ¶åˆ°å…¶ä»–è¯­è¨€ç›®å½•å¹¶ç¿»è¯‘ã€‚

3. **é‡æ–°æ„å»º**

```bash
pnpm build
```

---

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•ï¼ˆVitestï¼‰

**è¦†ç›–èŒƒå›´ï¼š**

- æ•°æ®åŠ è½½å·¥å…·ï¼ˆ`data-loader.ts`ï¼‰
- å…³ç³»è§£æå™¨ï¼ˆ`relationship-parser.ts`ï¼‰
- å›¾å¸ƒå±€ç®—æ³•ï¼ˆ`graph-layout.ts`ï¼‰

**è¿è¡Œæµ‹è¯•ï¼š**

```bash
pnpm test              # äº¤äº’å¼
pnpm test:run          # CI æ¨¡å¼
pnpm test:coverage     # è¦†ç›–ç‡æŠ¥å‘Š
```

### E2E æµ‹è¯•ï¼ˆPlaywrightï¼‰

**è¦†ç›–èŒƒå›´ï¼š**

- é¦–é¡µå’Œå¯¼èˆª
- è§’è‰²åˆ—è¡¨å’Œè¯¦æƒ…é¡µ
- å›½é™…åŒ–åˆ‡æ¢

**è¿è¡Œæµ‹è¯•ï¼š**

```bash
pnpm test:e2e         # è¿è¡Œ E2E æµ‹è¯•
pnpm test:e2e:ui      # UI æ¨¡å¼
```

---

## å®‰å…¨æªæ–½

### 1. å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰

é…ç½®åœ¨ `next.config.ts` ä¸­ï¼š

```typescript
headers: {
  'Content-Security-Policy': "default-src 'self'; ...",
  'X-Frame-Options': 'DENY',
  'X-Content-Type-Options': 'nosniff',
  'Referrer-Policy': 'strict-origin-when-cross-origin',
}
```

### 2. Docker å®‰å…¨

**æœ€å°åŒ–é•œåƒï¼š**

- ä½¿ç”¨ `distroless` åŸºç¡€é•œåƒ
- é root ç”¨æˆ·è¿è¡Œ
- å¤šé˜¶æ®µæ„å»º

---

## éƒ¨ç½²

### æ„å»º

```bash
pnpm build
```

**è¾“å‡ºï¼š**

- `.next/` - Next.js æ„å»ºäº§ç‰©
- `standalone/` - ç‹¬ç«‹éƒ¨ç½²åŒ…ï¼ˆDockerï¼‰

### Docker éƒ¨ç½²

```bash
docker build -t weare-esap .
docker run -p 3000:3000 weare-esap
```

### å¥åº·æ£€æŸ¥

Docker å®¹å™¨åŒ…å«å¥åº·æ£€æŸ¥ï¼š

```yaml
healthcheck:
  test: ["CMD", "node", "healthcheck.js"]
  interval: 30s
  timeout: 10s
  retries: 3
```

---

## æ€§èƒ½ç›‘æ§

é¡¹ç›®å·²é›†æˆ Web Vitals æ€§èƒ½ç›‘æ§ï¼š

**ç›‘æ§æŒ‡æ ‡ï¼š**

- **CLS** - ç´¯ç§¯å¸ƒå±€åç§»
- **FID** - é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ
- **FCP** - é¦–æ¬¡å†…å®¹ç»˜åˆ¶
- **LCP** - æœ€å¤§å†…å®¹ç»˜åˆ¶
- **TTFB** - é¦–å­—èŠ‚æ—¶é—´
- **INP** - äº¤äº’åˆ°ä¸‹æ¬¡ç»˜åˆ¶

**æŸ¥çœ‹æ•°æ®ï¼š**

- å¼€å‘ç¯å¢ƒï¼šæµè§ˆå™¨æ§åˆ¶å°
- ç”Ÿäº§ç¯å¢ƒï¼šlocalStorageï¼ˆ`web-vitals` keyï¼‰

---

## è´¡çŒ®æŒ‡å—

å‚è§ [CONTRIBUTING.md](../CONTRIBUTING.md) äº†è§£å¦‚ä½•ä¸ºé¡¹ç›®è´¡çŒ®ä»£ç ã€‚

---

## è®¸å¯è¯

- ä»£ç ï¼šApache License 2.0
- å†…å®¹ï¼šCC-BY 4.0

---

## è”ç³»æ–¹å¼

- å®˜ç½‘ï¼šhttps://weare.esaps.net
- GitHubï¼šhttps://github.com/AptS-1547/WeAreESAP
- é‚®ä»¶ï¼šapts-1547@esaps.net
